name: Validate Hugo Build for EdgeOne Pages

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  validate-build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        submodules: true
        fetch-depth: 0

    - name: Setup Hugo
      uses: peaceiris/actions-hugo@v2
      with:
        hugo-version: 'latest'
        extended: true

    - name: Validate Hugo Build
      run: |
        # æµ‹è¯•æ„å»º
        echo "ğŸ§ª Testing Hugo build for EdgeOne Pages..."
        hugo --minify --destination dist
        
        # éªŒè¯æ„å»ºç»“æœ
        echo "ğŸ“Š Build validation completed:"
        echo "  HTML files: $(find dist -name '*.html' | wc -l)"
        echo "  All files: $(find dist -type f | wc -l)"
        
        # æ£€æŸ¥å…³é”®æ–‡ä»¶
        echo "ğŸ“„ Critical files check:"
        [ -f "dist/index.html" ] && echo "âœ… Homepage exists" || echo "âŒ Homepage missing"
        [ -d "dist/posts" ] && echo "âœ… Posts directory exists" || echo "âŒ Posts directory missing"
        
        # åˆ—å‡ºpostsç›®å½•å†…å®¹
        if [ -d "dist/posts" ]; then
          echo "ğŸ“ Posts structure:"
          find dist/posts -name 'index.html' | head -10
        fi
        
        # éªŒè¯æ–‡ä»¶å†…å®¹
        if [ -f "dist/index.html" ]; then
          SIZE=$(stat -c%s "dist/index.html")
          echo "ğŸ“ Homepage size: ${SIZE} bytes"
          if [ "$SIZE" -lt 100 ]; then
            echo "âŒ Warning: Homepage seems too small"
            head -20 dist/index.html
          else
            echo "âœ… Homepage looks good"
          fi
        fi
        
        # æ¸…ç†æµ‹è¯•æ–‡ä»¶
        rm -rf dist
        
    - name: Build Instructions
      run: |
        echo "ğŸš€ Build validation passed!"
        echo "ğŸ“ EdgeOne Pages should build from master branch with:"
        echo "   Build Command: hugo --minify"
        echo "   Output Directory: public"
        echo "   Node.js Version: 18+"
        echo ""
        echo "ğŸŒ Site URL: https://cavaiblog-7gywpuewb5.edgeone.app/" 